{"data":{"site":{"siteMetadata":{"author":{"name":"Ayush Sharma","contacts":{"twitter":"ayusharma_"}},"disqusShortname":"ayusharma-github-io","subtitle":"Personal blog","title":"Ayush Sharma","url":"https://ayusharma.github.io"}},"markdownRemark":{"id":"93f32840-2364-5dac-a714-4fb18e378d1e","html":"<p><img src=\"/media/nodejs-npm-registry.png\" alt=\"alt\"></p>\n<p>Maintaining a private npm for your organization/team is very helpful when you would like to share the code only with them and not with the entire universe. You can develop and maintain all your organization specific projects and their components as node packages that can be reused.</p>\n<p>If there are multiple teams working, each of them can upload their own reusable node modules to the private npm and other teams can use them. For example a File upload component or an organization specific module and so on. This way, when you need something all you have to do is run npm install my-module , which will download the my-module for you.</p>\n<h2 id=\"can-i-run-my-own-private-registry\"><a href=\"#can-i-run-my-own-private-registry\" aria-label=\"can i run my own private registry permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Can I run my own private registry?</h2>\n<p>Yes!</p>\n<p>The easiest way is to replicate the couch database, and use the same (or similar) design doc to implement the APIs.</p>\n<p>If you set up continuous replication from the official CouchDB, and then set your internal CouchDB as the registry config, then you’ll be able to read any published packages, in addition to your private ones, and by default will only publish internally.</p>\n<p>If you then want to publish a package for the whole world to see, you can simply override the —registry option for that publish command.</p>\n<p><a href=\"https://docs.npmjs.com/misc/registry#can-i-run-my-own-private-registry\">Source - npm docs</a></p>\n<h2 id=\"couchdb\"><a href=\"#couchdb\" aria-label=\"couchdb permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CouchDB</h2>\n<p>CouchDB is a database that completely embraces the web. Store your data with JSON documents. Access your documents with your web browser, <a href=\"http://docs.couchdb.org/en/2.1.0/api/basics.html#api-basics\">via HTTP</a>. <a href=\"http://docs.couchdb.org/en/2.1.0/api/document/common.html#api-doc\">Query</a>, <a href=\"http://docs.couchdb.org/en/2.1.0/ddocs/views/index.html#views\">combine</a>, and <a href=\"http://docs.couchdb.org/en/2.1.0/ddocs/ddocs.html#listfun\">transform</a> your documents with <a href=\"http://docs.couchdb.org/en/2.1.0/query-server/javascript.html#query-server-js\">JavaScript</a>.</p>\n<p>You can <a href=\"http://docs.couchdb.org/en/2.1.0/install/index.html\">install couch db form here</a> according to your OS.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> -X GET http://localhost:5984/\n<span class=\"token punctuation\">{</span><span class=\"token string\">\"couchdb\"</span><span class=\"token keyword\">:</span><span class=\"token string\">\"Welcome\"</span>,<span class=\"token string\">\"uuid\"</span><span class=\"token keyword\">:</span><span class=\"token string\">\"eea0bdc8f2cae8a46a2d4274043e694b\"</span>,<span class=\"token string\">\"version\"</span><span class=\"token keyword\">:</span><span class=\"token string\">\"1.6.1\"</span>,<span class=\"token string\">\"vendor\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"name\"</span><span class=\"token keyword\">:</span><span class=\"token string\">\"The Apache Software Foundation\"</span>,<span class=\"token string\">\"version\"</span><span class=\"token keyword\">:</span><span class=\"token string\">\"1.6.1\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>You’ll need the following entries added in your <strong>/usr/local/etc/couchdb/default.ini</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[couch_httpd_auth]\npublic_fields = appdotnet, avatar, avatarMedium, avatarLarge, date, email, fields, freenode, fullname, github, homepage, name, roles, twitter, type, _id, _rev\nusers_db_public = true\n[httpd]\nsecure_rewrites = false\n[couchdb]\ndelayed_commits = false</code></pre></div>\n<p><strong>Once you have CouchDB installed, create a new database:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> -X PUT http://localhost:5984/registry</code></pre></div>\n<h2 id=\"replication\"><a href=\"#replication\" aria-label=\"replication permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Replication</h2>\n<p><em>Replication in computing involves sharing information so as to ensure consistency between redundant resources, such as software or hardware components, to improve reliability, fault-tolerance, or accessibility.</em> — Wikipedia</p>\n<p>When you ask CouchDB to replicate one database to another, it will go and compare the two databases to find out which documents on the source differ from the target and then submit a batch of the changed documents to the target until all changes are transferred. Changes include new documents, changed documents, and deleted documents. Documents that already exist on the target in the same revision are not transferred; only newer revisions are.</p>\n<h3 id=\"continuous-replication\"><a href=\"#continuous-replication\" aria-label=\"continuous replication permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Continuous Replication</h3>\n<p>CouchDB will not stop after replicating all missing documents from the source to the target. It will listen on CouchDB’s <code class=\"language-text\">_changes</code> and automatically replicate over any new docs as they come into the source to the target.</p>\n<p><strong>Replicating npm Mirror DB</strong> — <a href=\"https://skimdb.npmjs.com/registry\">https://skimdb.npmjs.com/registry</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> -X POST http://127.0.0.1:5984/_replicate -d ‘<span class=\"token punctuation\">{</span>“source”:”https://skimdb.npmjs.com/registry<span class=\"token string\">\", “target”:”registry”, “continuous”:true}’ -H “Content-Type: application/json”\n{\"</span>ok<span class=\"token string\">\":true,\"</span>_local_id<span class=\"token string\">\":\"</span>856a4fb78d193cbe92215ee7b1d55ce3+continuous\"<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"verdaccio\"><a href=\"#verdaccio\" aria-label=\"verdaccio permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Verdaccio</h2>\n<p><img src=\"/media/verdaccio-banner@2x.png\" alt=\"alt\"></p>\n<p><a href=\"https://github.com/verdaccio/verdaccio\">https://github.com/verdaccio/verdaccio</a></p>\n<p>A lightweight private npm proxy registry.</p>\n<p>We’ll use it to manage our private packages and point our registry to get 3rd party npm packages.</p>\n<p>It allows you to have a local npm private registry with zero configuration. You don’t have to install and replicate an entire database. Verdaccio keeps its own small database and, if a package doesn’t exist there, it asks any other registry (in our case, replicated registry) for it keeping only those packages you use.</p>\n<h3 id=\"installation-and-starting\"><a href=\"#installation-and-starting\" aria-label=\"installation and starting permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation and starting</h3>\n<p>Application will create default config in config.yaml which you can edit later.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --global verdaccio</code></pre></div>\n<p>Run in your terminal</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">verdaccio</code></pre></div>\n<p>You would need set some npm configuration, this is optional.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> <span class=\"token keyword\">set</span> registry http://localhost:4873/\n<span class=\"token comment\"># if you use HTTPS, add an appropriate CA information</span>\n<span class=\"token comment\"># (\"null\" means get CA list from OS)</span>\n$ <span class=\"token function\">npm</span> <span class=\"token keyword\">set</span> ca null</code></pre></div>\n<p>Now you can navigate to <a href=\"http://localhost:4873/\">http://localhost:4873/</a> where your local packages will be listed and can be searched.</p>\n<h2 id=\"point-replicated-registry\"><a href=\"#point-replicated-registry\" aria-label=\"point replicated registry permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Point replicated registry</h2>\n<p>Edit <code class=\"language-text\">~/.config/verdaccio/config.yaml</code> and change uplink to:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">uplinks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">npmjs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> &lt;Replicated registry<span class=\"token punctuation\">></span></code></pre></div>\n<p>Now, You can start to manage your packages on your own server.</p>\n<p>For more, visit <a href=\"https://verdaccio.org\">https://verdaccio.org</a></p>","fields":{"slug":"/posts/npm-registry-for-your-organization/","tagSlugs":["/tag/package-manager/","/tag/development/"]},"frontmatter":{"date":"2019-03-27T22:40:32.169Z","description":"A quick dig at setting up our own private Node Package Registry with Verdaccio.","tags":["Package Manager","Development"],"title":"npm registry for your organization"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/npm-registry-for-your-organization/"}}